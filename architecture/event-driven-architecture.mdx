---
title: Event-driven architecture
description: How to use event-driven architecture with Architect
---

## Brokers

```yaml architect.yml
name: gcp-pubsub

secrets:
  gcp_project_id:
    description: Name of the GCP project to connect to
    default: test
  service_endpoint:
    description: If you want to connect to the remote pub/sub service, use the value 'pubsub.googleapis.com'. Otherwise, the local emulator will be used.
    required: false
  service_protocol:
    description: If you want to connect to the remote pub/sub service, use the value 'https'. Otherwise, the local emulator will be used.
    default: http
  service_port:
    description: If you want to connect to the remote pub/sub service, use the value '443'. Otherwise, the local emulator will be used.
    default: 8085

services:
  pubsub:
    image: gcr.io/google.com/cloudsdktool/cloud-sdk:emulators
    command: gcloud beta emulators pubsub start --host-port=0.0.0.0:${{ secrets.service_port }} --project=${{ secrets.gcp_project_id }}
    interfaces:
      main:
        host: ${{ secrets.service_endpoint }}
        protocol: ${{ secrets.service_protocol }}
        port: ${{ secrets.service_port }}
        ingress:
          subdomain: pubsub
```

## Publishers

```yaml architect.yml
name: publisher

secrets:
  publish_topic:
    description: Topic name the service will publish events to
    default: topic

outputs:
  publish_topic:
    description: Topic name events will be published to
    value: ${{ secrets.publish_topic }}

dependencies:
  gcp-pubsub: {}

services:
  api:
    build:
      context: ./
    environment:
      GCP_PROJECT_ID: ${{ dependencies['gcp-pubsub'].outputs.gcp_project_id }}
      PUBSUB_ENDPOINT: ${{ dependencies['gcp-pubsub'].services.pubsub.interfaces.main.url }}
      PUBSUB_TOPIC: ${{ secrets.publish_topic }}
```

## Subscribers

```yaml architect.yml
name: subscriber

secrets:
  subscription_key:
    description: Key used to define this subscriber
    default: subscriber

dependencies:
  gcp-pubsub: {}
  publisher: {}

services:
  api:
    build:
      context: ./
    environment:
      PUBSUB_ENDPOINT: ${{ dependencies['gcp-pubsub'].services.pubsub.interfaces.main.url }}
      GCP_PROJECT_ID: ${{ dependencies['gcp-pubsub'].outputs.gcp_project_id }}
      PUBSUB_TOPIC: ${{ dependencies['publisher'].outputs.publish_topic }}
      PUBSUB_SUBSCRIPTION: ${{ secrets.subscription_key }}
```