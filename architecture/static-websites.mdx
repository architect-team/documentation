---
title: Static websites
description: Declare and deploy static websites using Architect
---

Static websites are all the rage when it comes to fast-loading frontend applications. They're
cheap to operate because they can easily be cached by your favorite CDNs for edge distribution.

In this guide, you'll learn all about testing and debugging static websites using Architect and
employing common CDNs for improved production performance. If you want to skip the tutorial and
start from a working project, feel free to run `architect init` to have everything done for you.

## Creating the service

The interesting thing about _developing_ static sites is that they're never static when they're
actively being worked on. If you're making code changes, the whole site needs to be recompiled
before it can be rendered.

Fortuntely, Architect makes it easy for developers to create components with different behavior for dev
and production deployments. Developers can use different dockerfiles or commands using the `debug` block
to facilitate hot-reloading in their favorite languages and frameworks.

<CodeGroup>
```yaml architect.yml
services:
  api:
    build:
      context: ./
    interfaces:
      main:
        port: 8080
    debug:
      build:
        dockerfile: Dockerfile.dev
      volumes:
        src:
          mount_path: /app/src
          host_path: ./src
        
```

```dockerfile Dockerfile
# Reference from nextjs repo: https://github.com/vercel/next.js/blob/canary/examples/with-docker/Dockerfile

# Install dependencies only when needed
FROM node:16-alpine AS deps
# Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.
RUN apk add --no-cache libc6-compat
WORKDIR /app

# Install dependencies based on the preferred package manager
COPY package.json package-lock.json ./
RUN npm ci

# Rebuild the source code only when needed
FROM node:16-alpine AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

RUN npm run build

# Production image, copy all the files and run next
FROM node:16-alpine AS runner

RUN apk add --no-cache curl

WORKDIR /app

ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public

# Automatically leverage output traces to reduce image size
# https://nextjs.org/docs/advanced-features/output-file-tracing
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

CMD ["node", "server.js"]
```

```dockerfile Dockerfile.dev
FROM node:16-alpine AS deps
# Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.
RUN apk add --no-cache libc6-compat curl
WORKDIR /app

COPY package.json package-lock.json ./
RUN npm ci

COPY . .

CMD ["npm", "run", "dev"]
```
</CodeGroup>

## Setup caching w/ Cloudflare

<Note>
  This feature only works with a custom domain set up in the environment your application is deployed.
</Note>

Caching in Cloudflare offers significant performance benefits such as reducing server load, enhancing scalability, and improving the user experience of your application.
By leveraging Cloudflare's caching capabilities, you can optimize the delivery of your content and achieve faster, more reliable, and cost-effective web experiences.

### Add a domain in Architect.io
Let's say you have an account name `my-account`. Under this account, create an environment, for example `example-environment`. 
Go to the `Settings` of `example-environment` and provide your DNS Zone.
Click on `Register DNS Zone`. Copy the target endpoint to be used in configuration of Cloudflare DNS record.

### Configure cache in Cloudflare
To setup caching with Cloudflare, register a Cloudflare account and add your domain.
Then, configure the DNS records for your domain by creating a CNAME using the copied target endpoint generated by Architect.io.
To add a DNS record, click on the `Add record` button, select `CNAME` from `Type`, put in the wildcard `*` for `Name`, and the target endpoint for `IPv4 address`.

Once the DNS record is added to Cloudflare, go to the `Caching` section of the Cloudflare sidebar. 
Under `Configuration`, you can change the different settings of caching to fit your need, such as `Caching Level`, `Browser Cache TTL`, etc.

You can also customize the caching behavior of specific HTTP requests by setting up Cache Rules in Cloudflare. 
Cache Rules allow you to define criteria and actions to determine how Cloudflare should cache and serve content from its servers.
For example, if the domain name is `example.com` and you would like to cache all the HTTP requests, configure the `Field` to match `Hostname` with `Operator` of `contains` and `Value` of `example.com`.
![Cache rule](/images/cache-rule.png)
Then, give this rule a name and click on `Deploy`. 

Now, deploy your application in the `example-environment`.

### Verify caching in browser
Once your application is successfully deployed with Architect, go to an endpoint of your website, for example, `<service-name>.example.com` where `<service-name>` is a service name of your application.
Next, open `Network` of your browser. For Mac, use `Command + Option + I` and for Windows, Linux, Chrome: `Control + Shift + I`.
Click on the endpoint that you cached and inspect the `Reponse Headers`. After a hard reload of your browser, you should see the `cf-cache-status` to be `HIT`.
```
cf-cache-status: HIT
```
This indicates that the data are retrieved from the Cloudflare cache instead of fetching it from the origin server.

When you access a website that is using Cloudflare caching, the first request will usually take longer to load because it has to fetch the content from the origin server.
Subsequent requests for the same content should be faster because Cloudflare will serve the content from its cache instead of fetching it from the origin server.

[Learn more about Cloudflare Cache](https://developers.cloudflare.com/cache/)
